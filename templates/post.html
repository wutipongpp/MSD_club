<!doctype html>
<html lang="th">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MSD Club ‚Äî ‡∏î‡∏π‡πÇ‡∏û‡∏™‡∏ï‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/static/picture/MSD.jpg">
    <style>
    :root{ --red:#c70707; --blue:#2d32c7; --yellow:#FDC500; --bg:#FAFAFA; }
    body{ background:var(--bg); }
    </style>
</head>
<body class="flex flex-col min-h-screen text-slate-900 bg-[var(--bg)]">
    <!-- HEADER -->
    <header class="sticky top-0 z-50 border-b text-white"
            style="background:linear-gradient(90deg,var(--red),var(--blue))">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
        <a href="/" class="flex items-center gap-3">
            <span class="w-10 h-10 rounded-xl overflow-hidden">
            <img src="/static/picture/MSD.jpg" alt="icon" class="w-full h-full object-cover" />
            </span>
            <div class="hidden md:block">
            <div class="text-lg font-extrabold tracking-wide">MSD Club</div>
            <div class="text-xs opacity-90">Math ¬∑ Stat ¬∑ Data Science</div>
            </div>
        </a>
        <nav class="flex gap-1">
            <a class="px-3 py-2 rounded-lg hover:bg-white/10" href="/">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
            <a class="px-3 py-2 rounded-lg hover:bg-white/10" href="/alumni">‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡πÄ‡∏Å‡πà‡∏≤</a>
            <a class="px-3 py-2 rounded-lg hover:bg-white/10 bg-white/10" href="/announcements">‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</a>
        </nav>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="max-w-4xl mx-auto px-4 my-10 flex-1">
    <div id="postBox" class="card overflow-hidden">
      <div id="postImage" class="bg-gray-100 flex items-center justify-center">
        <span class="text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>
      </div>
      <div class="p-6">
        <h1 id="postTitle" class="text-3xl font-extrabold text-blue-950 mb-3">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÇ‡∏û‡∏™‡∏ï‡πå</h1>
        <div id="postContent" class="text-gray-700 leading-relaxed whitespace-pre-line">
          ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÇ‡∏û‡∏™‡∏ï‡πå
        </div>
        <div id="postDate" class="text-xs text-gray-500 mt-4 text-right"></div>
      </div>
    </div>
        <section class="max-w-6xl mx-auto px-4 mt-8 mb-12">
        <h3 class="text-2xl font-extrabold text-blue-950 mb-4 border-b-2 border-blue-200 inline-block pb-1">
            üì∞ ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        </h3>
        <div id="latest" class="grid md:grid-cols-3 gap-6"></div>
        </section>
  </main>

        

    <!-- FOOTER -->
    <footer class="mt-auto text-white text-sm"
            style="background:linear-gradient(90deg,var(--blue),var(--red))">
        <div class="max-w-6xl mx-auto px-4 py-6 text-center">
        ¬© <span id="y"></span> MSD Club
        </div>
    </footer>

<script>
    // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    const isAdmin = JSON.parse(localStorage.getItem('msd:isAdmin') || 'false');

    if (isAdmin) {
        // ‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏≥‡∏ó‡∏≤‡∏á (navbar)
        const nav = document.querySelector('nav');

        // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° "‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô"
        const adminLink = document.createElement('a');
        adminLink.href = "/admin"; // ‚Üê ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        adminLink.textContent = "‚öôÔ∏è ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô";
        adminLink.className = "px-3 py-2 rounded-lg bg-yellow-400 text-blue-950 font-bold hover:bg-yellow-300 transition";

        // ‚úÖ ‡πÅ‡∏ó‡∏£‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡πâ‡∏≤‡∏¢ nav
        nav.appendChild(adminLink);
    }
</script>

    <script>
  // üß≠ ‡∏î‡∏∂‡∏á ID ‡∏Ç‡∏≠‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏à‡∏≤‡∏Å URL
  const postId = parseInt(window.location.pathname.split('/').pop());
  const postBox = document.getElementById('postBox');
  const imgBox = document.getElementById('postImage');
  const titleEl = document.getElementById('postTitle');
  const contentEl = document.getElementById('postContent');
  const dateEl = document.getElementById('postDate');
  const latest = document.getElementById('latest');

  // üìÖ ‡πÉ‡∏™‡πà‡∏õ‡∏µ footer
  document.getElementById('y').textContent = new Date().getFullYear();

  // üì° ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏à‡∏≤‡∏Å Flask API
  async function loadPost() {
    try {
      const res = await fetch('/api/posts');
      if (!res.ok) throw new Error('‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');
      const posts = await res.json();

      // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
      const post = posts.find(p => p.id === postId);
      if (!post) {
        postBox.innerHTML = `<div class="p-6 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ</div>`;
        return;
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û (auto size)
      imgBox.innerHTML = '';
      if (post.image) {
        const img = new Image();
        img.src = post.image;
        img.className = "w-full h-auto block object-contain rounded-xl";
        imgBox.appendChild(img);
      } else {
        imgBox.innerHTML = `<div class="w-full bg-gray-100 flex items-center justify-center text-gray-400 py-20">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>`;
      }

      // ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ / ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ / ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
      titleEl.textContent = post.title || '(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠)';
      contentEl.textContent = post.content || '';
      const date = new Date(post.created_at || post.updated_at);
      dateEl.textContent = `‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠ ${date.toLocaleString('th-TH', { dateStyle: 'long', timeStyle: 'short' })}`;

      // ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ)
      renderLatest(posts.filter(p => p.id !== postId));
    } catch (err) {
      console.error(err);
      postBox.innerHTML = `<div class="p-6 text-center text-red-500">‚ùå ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>`;
    }
  }

  // üì∞ ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (3 ‡∏≠‡∏±‡∏ô)
  function renderLatest(posts) {
    latest.innerHTML = '';
    if (!posts.length) {
      latest.innerHTML = `<div class="text-gray-500 text-center py-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</div>`;
      return;
    }

    posts
      .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
      .slice(0, 3)
      .forEach(p => {
        const wrap = document.createElement('a');
        wrap.href = `/post/${p.id}`;
        wrap.className = `
          group block rounded-2xl overflow-hidden bg-white shadow-md hover:shadow-xl 
          hover:-translate-y-1 border border-gray-200 transition-all duration-300
        `;

        const img = p.image
          ? `<div class="aspect-video relative overflow-hidden">
                <img src="${p.image}" class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
                <div class="absolute inset-0 bg-black/10 opacity-0 group-hover:opacity-30 transition"></div>
             </div>`
          : `<div class="aspect-video bg-gray-100 flex items-center justify-center text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</div>`;

        wrap.innerHTML = `
          ${img}
          <div class="p-4">
            <div class="font-semibold text-blue-950 text-lg mb-1 group-hover:text-blue-600 transition">
              ${p.title}
            </div>
            <div class="text-sm text-gray-600 leading-snug">
              ${(p.content || '').slice(0, 90)}${(p.content || '').length > 90 ? '‚Ä¶' : ''}
            </div>
            <div class="mt-3 text-xs text-gray-400 flex items-center gap-1">
              üïì ${new Date(p.created_at).toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric' })}
            </div>
          </div>`;
        latest.appendChild(wrap);
      });
  }

  // üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°
  document.addEventListener('DOMContentLoaded', loadPost);
</script>

</body>

</body>
</html>
